<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>layui</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="./../../lib/layui/css/layui.css"  media="all">
  <link rel="stylesheet" href="./../../css/font.css">
  <link rel="stylesheet" href="./../../css/xadmin.css">
  <script type="text/javascript" src="./../../js/jquery.min.js"></script>
  <script type="text/javascript" src="./../../lib/layui/layui.js" charset="utf-8"></script>
  <script type="text/javascript" src="./../../js/xadmin.js"></script>
</head>
<body> 
<div class="x-body" id="x-body">
    <div class="x-nav">
        <span class="layui-breadcrumb">
            <a href="">首页</a>
            <a href="">演示</a>
            <a><cite>导航元素</cite></a>
        </span>
        <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
    </div>

    <div class="x-body" id="x-body">
        <div class="layui-row">
            <form class="layui-form layui-col-md12 x-so">
                <input type="text" name="username"  v-model="sublist" placeholder="请输入用户名" autocomplete="off" class="layui-input">
                <a class="layui-btn"  lay-submit="" lay-filter="demo1" @click="writeRedisList()">添加到redis</a>
            </form>
        </div>
        <!-- <xblock> -->
            <div class="layui-btn-group demoTable">
                <button class="layui-btn layui-btn-danger" data-type="getCheckData" @click="delRedisList()" ><i class="layui-icon"></i>清除redis</button>
            </div>
            <button class="layui-btn" @click="writeMysql()"><i class="layui-icon"></i>redis写入到数据库</button>
        <!-- </xblock> -->
        <table class="layui-hide" id="LAY_table_user"  lay-filter="demo"></table> 
    </div>
     
    <div style="padding: 20px; background-color: #F2F2F2;">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">redis列表</div>
                    <template v-for="item in redisList">
                        <div class="layui-card-body"> {{item}} </div>
                    </template>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">数据库列表</div>
                    <template v-for="item in mysqlList">
                        <div class="layui-card-body">{{ item.redis_name }}</div>
                    </template>
                </div>
            </div>
        </div>
    </div> 
</div> 
<script src="./../../lib/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="./../../js/vue.js"></script>
<script type="text/javascript" src="./../../js/vue-resource.min.js"></script>
<script>

var app = new Vue({
    el: '#x-body',
    data: {
        sublist: '',
        redisList: {},
        mysqlList: {}
    },
    methods:{
        // 获取缓存列表
        getRedisList:function(){
            var _this = this;
            var url = apiUrl+'Rbac/checkRedisList';
            var data = {
                // token:sessionStorage.getItem('auth_user_token')
            };
            _this.$http.get(url, data ,{emulateJSON:true}).then(function(response){
                var result = response.body;
                if( result.code !== 0 ){
                    layer.msg(result.msg,{icon:2});
                }
                _this.redisList = result.data
            });
        },
        writeRedisList:function(){
            var _this = this;
            if( _this.sublist === "" || _this.sublist === null ){
                return false;
            }
            var url = apiUrl+'Rbac/writeRedisList?name='+_this.sublist;
            var data = {
                // token:sessionStorage.getItem('auth_user_token')
            };
            _this.$http.get(url, data ,{emulateJSON:true}).then(function(response){
                var result = response.body;
                if( result.code !== 0 ){
                    layer.msg(result.msg,{icon:2});
                }
                _this.getRedisList();
                _this.sublist = "";
            });
        },
        // 清除缓存
        delRedisList:function(){
            var _this = this;
            if( _this.redisList.length <= 0 ){
                return false;
            }
            var url = apiUrl+'Rbac/delRedisList';
            var data = {
                // token:sessionStorage.getItem('auth_user_token')
            };
            _this.$http.get(url, data ,{emulateJSON:true}).then(function(response){
                var result = response.body;
                if( result.code !== 0 ){
                    layer.msg(result.msg,{icon:2});
                }
                _this.getRedisList();
            });
        },
        // 获取数据库的数据
        checkMysql:function(){
            var _this = this;
            var url = apiUrl+'Rbac/checkMysql';
            var data = {
                // token:sessionStorage.getItem('auth_user_token')
            };
            _this.$http.get(url, data ,{emulateJSON:true}).then(function(response){
                var result = response.body;
                if( result.code !== 0 ){
                    layer.msg(result.msg,{icon:2});
                }
                _this.mysqlList = result.data;
                console.log( _this.mysqlList )
            });
        },
        // 把缓存内的数据写入数据库
        writeMysql:function(){
            var _this = this;
            if( _this.redisList.length <= 0 ){
                layer.msg('没有缓存数据',{icon:2});
                return false;
            }
            var url = apiUrl+'Rbac/writeMysql';
            var data = {
                // token:sessionStorage.getItem('auth_user_token')
            };
            _this.$http.get(url, data ,{emulateJSON:true}).then(function(response){
                var result = response.body;
                if( result.code !== 0 ){
                    layer.msg(result.msg,{icon:2});
                }
                _this.getRedisList();
                _this.checkMysql();
            });
        },
    },
    mounted(){
        var _this = this;
        _this.getRedisList();
        _this.checkMysql();
        console.log(apiUrl);
    },
});

</script>
</body>
</html>